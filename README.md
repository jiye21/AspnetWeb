# AspnetWeb

## 핵심 기능 설명

>  **쇼핑 페이지 컨트롤러 구현 (캐싱서버 사용)​​**
- ( 코드: /Controllers/MyPageController.cs의 line 70, 108, 150, 293(redis 캐싱함수) )​

- 물건 구매 기능 구현. 

- 쇼핑 페이지에서 요구하는 쇼핑목록 데이터를 클라이언트에게 전송.

  이때 데이터는 최초 접속시에는 DB로부터 읽어들인 후 redis에도 캐싱해두고, ​데이터의 생성, 삭제, 수정 등의 변동사항이 없다면​ 다음 요청시(페이지 새로고침)부터는 redis에서 데이터를 읽어 클라이언트에게 전송. ​

- 물건 구매: 클라이언트로부터 온, 사용자가 페이지에서 구매한 물건 목록 데이터를​ DB에 저장함. ​

  이때 데이터의 생성이라는 변동사항이 생겼으므로, redis에 새로운 데이터를 다시 캐싱. ​



>  **회원가입**
- ( 코드: /AuthService.cs 파일 line 40~62 )​

- 브라우저단에서 해시함수(SHA-256)을 이용해 패스워드를 해시화하여 서버로 전송​

   ->해커가 중간에 패킷을 낚아채도 패스워드를 알 수 없게 하기 위함​

- 전달받은 패스워드에 salt값을 더함. 그리고 이것을 SHA-256알고리즘을 이용해 한번 더​
해시화하여 DB에 저장. ​

  ->해시를 사용한 이유: 해시 특성상 원본이 하나만 바뀌어도 결과값 전체가 바뀌어 ​원본을 조작했는지 여부를 알기가 쉬워서 해시를 사용하였습니다. ​

  ->salt를 사용한 이유: 해시값을 저장해두는 레인보우 테이블로 해커가 암호화된 ​데이터를 유추할 수 없도록 개발자만 알고 있는 값인 salt를 더하였습니다. ​


>  **회원가입 테이블 설계​**
- 이메일 가입, OAuth 가입 2가지의 회원가입 방식이 존재​

- 회원정보를 회원가입 방식에 따라 테이블을 분리하여 저장​

   ->만약 하나의 테이블에서 모든 유저를 관리한다면, 추후 카카오 회원가입 등​ 회원가입 방식이 늘어나면 테이블 스키마 변경이 어렵습니다. ​또한 이메일 회원가입이 아닌 구글 회원가입의 경우에는 ID, PW 컬럼에 null값을 넣는​
안좋은 상황이 발생하여 테이블을 분리하여 관리했습니다. ​


>  **세션 로그인​**
- ( 코드: /Controllers/AccountController.cs 파일 line 48~66 )​

-  유저가 인증과정을 거쳤다는 것을 서버에 기록하기 위해 세션을 사용​

- 로그인 성공 시 세션키를 발급 후 만료시간과 함께 redis에 set,​ 그와 동시에 redis와 동일한 시각에 만료되게 설정한 쿠키에 저장해 클라이언트에게 응답으로 전송. ​

  추후 로그인이 필요한 기능에서 쿠키를 통해 사용자 인증 처리. ​

- redis에 세션을 set할 때 key에는 세션키, value에는 uid를 저장해​ 특정 세션키에 해당하는 유저가 누구인지 알 수 있게 함. ​

>  **JWT 로그인​**
- ( 코드: /Controllers/AccountController.cs 파일 line 75~92 )​

- 로그인 성공 시 JWT를 발급하여 쿠키에 저장해 클라이언트에게 응답으로 전송. ​
  
  추후 로그인이 필요한 기능에서 요청 쿠키로 온 JWT를 서버에서 검증해​ 사용자 인증 처리. ​


>  **OAuth 로그인 (구글)​**
- ( 코드: /Controllers/AccountController.cs 파일 line 206~221에서 ​
/Controllers/HomeController.cs의 line 41의 함수 호출 )​

- 구글을 통해 로그인 성공 시 받은 Authorization code로 구글 AccessToken을 받음. ​이 토큰으로 구글에서 유저의 데이터(이름, 성별, 이메일 등)를 받아옴. ​

- 구글에서 받아온 데이터로 DB를 검색하여 이미 존재하는 유저라면 바로 로그인​ 처리. 이와 동시에 세션키를 생성해 redis에 저장 후 클라이언트에게 응답 쿠키로 전송. ​
(=세션 로그인 방식과 동일)​

- 로그인이 성공하면 미리 구글 관리자 페이지에 등록해둔 uri로 redirect 됨. ​

- 만약 존재하지 않는 유저라면 다시 로그인 페이지로 redirect 시킴. ​


>  **모듈화 - ASP .NET의 미들웨어 사용​​**
- 1. /api 로 시작하는 경로로 요청이 들어올 때​

  ( 코드: /RequestAuthMiddleware.cs )​

  장바구니에 담긴 물건 구매 등 인증이 필요한 요청은 전부 /api로 시작하도록 함.​

  요청이 들어오면 세션 로그인일 경우 세션 검증 후 세션키 재발급(업데이트), ​JWT 로그인일 경우 토큰 검증을 시행함. ​

  만약 세션검증 혹은 JWT검증 실패시 다음 파이프라인으로 넘어가지 못하게 함. ​

- 2. /Account 로 시작하는 경로로 요청이 들어올 때​

  ( 코드: /CheckLoginMiddleware.cs )​

  중복 로그인 방지를 위함​

  로그인, 회원가입 페이지만 /Account로 경로가 시작됨. ​

  세션, JWT로그인 모두 브라우저의 쿠키에 정보를 구워놓아, ​클라이언트가 서버에 요청을 보낼때마다 자동으로 정보가 쿠키에 담겨서 오는 것을​ 이용해 만약 이미 세션이나 JWT 정보가 쿠키에 존재한다면 ​
로그인, 회원가입 페이지에 접속하지 못하도록 함. ​




## <img src="https://github.com/user-attachments/assets/ef4dfb60-dcab-4844-9bd2-84e99e2316a7" width=50>  멘토링에서 배운 개념정리
- [✏️개념정리_1](https://github.com/jiye21/AspnetWeb/wiki/%EB%A9%98%ED%86%A0%EB%A7%81-%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC_1)
- [✏️개념정리_2](https://github.com/jiye21/AspnetWeb/wiki/%EB%A9%98%ED%86%A0%EB%A7%81-%EA%B0%9C%EB%85%90%EC%A0%95%EB%A6%AC_2)
<br>

> **쇼핑몰, 게시판 웹서비스 시연영상:** <br>

[![Video Label](http://img.youtube.com/vi/ucaZ2-k5Smo/0.jpg)](https://youtu.be/ucaZ2-k5Smo)
